<% multiple = local_assigns[:multiple] %>
<% selected_ids = local_assigns[:selected_ids] %>
<% dropdown_class = "ui fluid #{'multiple' if multiple} search selection dropdown" %>
<% default_text = "Tag".pluralize multiple %>

<% if local_assigns.key? :tags %>
  <% tags = local_assigns[:tags].map {|i| [i.id, i.name, i.color, i.icon.icon]} %>
<% else %>
  <% tags = Tag.includes(:semantic_ui_icon).pluck(:id, :name, :color, 'semantic_ui_icons.icon') %>
<% end %>

<%# =================================================================== %>

<div class="<%= dropdown_class %>">
  <input name="tags" type="hidden">

  <i class="dropdown icon"></i>
  <%= content_tag :div, default_text, class: "default text" %>

  <div class="menu">

    <% tags.each do |id, name, css| %>
      <div class="item" data-value="<%= id %>">
        <i class="<%= css %>"></i>
        <%= name.capitalize %>
      </div>
    <% end %>

  </div>
</div>

<% if selected_ids %>
  <script>
   $('.ui.fluid.dropdown').dropdown(
       'set selected',
       [<%= selected_ids.map {|i| "'#{i}'"}.join(',').html_safe %>]
   );
  </script>
<% end %>
